// const lib = require('./lib.js') // common js method
//ES6 METHOD
// import {sum,diff} from './lib.js'
// console.log(sum(10,9),diff(3,2))
// const fs = require('fs');
// const t1= performance.now();
// fs.readFile('demo.txt','utf-8',(err,txt)=>{
    
//     console.log(txt);
   
// });
// const t2=performance.now();
// console.log(t2-t1);
// const txt=fs.readFileSync('demo.txt','utf-8');//It goes synchronously with readFileSync
// console.log(txt);
// const express = require('express');
// console.log('hello');
// const server = express();
// server.listen(8080);//It is used to bind to the port to the port
const http = require('http');
const fs = require('fs');

const index = fs.readFileSync('index.html','utf-8');
// const data = fs.readFileSync('data.json','utf-8');
const data = JSON.parse(fs.readFileSync('data.json','utf-8'));
const products = data.products;
// const data = {age:5};
const server = http.createServer((req,res)=>{

    console.log(req.url,req.method);
    if(req.url.startsWith('/product')){
        const id = req.url.split('/')[2]
       const product= products.find(p=>p.id===(+id))
        console.log(product);
        res.setHeader('Content-Type','text/html');
        let modifiedIndex = index.replace('**title**',product.title)
        .replace('**url**',product.thumbnail)
       
        .replace("**price**",product.price)
        .replace('**rating**',product.rating);
        res.end(modifiedIndex);
        return;
    }
    switch(req.url){
        case '/':
            res.setHeader('Content-Type','text/html');
            res.end(index);
            break;
        case '/api':
            res.setHeader('Content-Type','application/json');
            res.end(data);
            break;
            
            default:
                res.writeHead(404,'Not Found');
                res.end();
    }
    console.log('server started');
// res.setHeader('Dummy','DummyValue');


    // res.end(JSON.stringify(data));
   
    
   
})
server.listen(8000);
